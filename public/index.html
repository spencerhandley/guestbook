<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Guestbook</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f0f2f5;
      color: #1a1a2e;
      min-height: 100vh;
    }

    .container {
      max-width: 640px;
      margin: 0 auto;
      padding: 48px 20px;
    }

    h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 32px;
      text-align: center;
    }

    .form-card {
      background: #fff;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
      margin-bottom: 32px;
    }

    .form-card input,
    .form-card textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 0.95rem;
      font-family: inherit;
      transition: border-color 0.2s;
    }

    .form-card input:focus,
    .form-card textarea:focus {
      outline: none;
      border-color: #4361ee;
    }

    .form-card input {
      margin-bottom: 12px;
    }

    .form-card textarea {
      margin-bottom: 16px;
      resize: vertical;
      min-height: 80px;
    }

    .form-card button {
      width: 100%;
      padding: 12px;
      background: #4361ee;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .form-card button:hover {
      background: #3a56d4;
    }

    .form-card button:disabled {
      background: #a0aec0;
      cursor: not-allowed;
    }

    .entries-header {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 16px;
      color: #555;
    }

    .entry {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
      margin-bottom: 12px;
    }

    .entry-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .entry-name {
      font-weight: 600;
      font-size: 1rem;
    }

    .entry-time {
      font-size: 0.8rem;
      color: #888;
    }

    .entry-message {
      font-size: 0.95rem;
      line-height: 1.5;
      color: #444;
    }

    .empty {
      text-align: center;
      color: #999;
      padding: 32px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Guestbook</h1>

    <div class="form-card">
      <form id="guestbook-form">
        <input type="text" id="name" placeholder="Your name" required maxlength="100">
        <textarea id="message" placeholder="Leave a message..." required maxlength="500"></textarea>
        <button type="submit">Sign Guestbook</button>
      </form>
    </div>

    <div id="entries"></div>
  </div>

  <script>
    const form = document.getElementById("guestbook-form");
    const entriesContainer = document.getElementById("entries");
    const nameInput = document.getElementById("name");
    const messageInput = document.getElementById("message");

    function formatDate(iso) {
      const d = new Date(iso);
      return d.toLocaleDateString("en-US", {
        month: "short", day: "numeric", year: "numeric",
        hour: "numeric", minute: "2-digit",
      });
    }

    function renderEntries(entries) {
      if (entries.length === 0) {
        entriesContainer.innerHTML = '<div class="empty">No entries yet. Be the first to sign!</div>';
        return;
      }

      entriesContainer.innerHTML =
        '<div class="entries-header">' + entries.length + " " + (entries.length === 1 ? "entry" : "entries") + "</div>" +
        entries.map(e =>
          '<div class="entry">' +
            '<div class="entry-meta">' +
              '<span class="entry-name">' + escapeHtml(e.name) + '</span>' +
              '<span class="entry-time">' + formatDate(e.timestamp) + '</span>' +
            '</div>' +
            '<div class="entry-message">' + escapeHtml(e.message) + '</div>' +
          '</div>'
        ).join("");
    }

    function escapeHtml(text) {
      const div = document.createElement("div");
      div.textContent = text;
      return div.innerHTML;
    }

    async function loadEntries() {
      const res = await fetch("/api/entries");
      const entries = await res.json();
      renderEntries(entries);
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const btn = form.querySelector("button");
      btn.disabled = true;

      const res = await fetch("/api/entries", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          name: nameInput.value,
          message: messageInput.value,
        }),
      });

      if (res.ok) {
        messageInput.value = "";
        await loadEntries();
      }

      btn.disabled = false;
    });

    loadEntries();
  </script>
</body>
</html>
